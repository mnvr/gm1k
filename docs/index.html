<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>Generative music in less than 1K of JavaScript</title>
    </head>
    <body>
        <!-- We need a button etc to start playback; browsers won't emit sound
             without user interaction -->
        <button onclick="toggle()">play</button>
        <script>
            let context;
            function toggle() {
                const button = document.getElementsByTagName("button")[0];
                if (context) {
                    button.innerText = "play";
                    context.close();
                    context = undefined;
                } else {
                    button.innerText = "pause";
                    play();
                }
            }

            async function play() {
                console.log("play");
                context = new AudioContext();

                // Plays a 440 Hz sine by default
                const osc = context.createOscillator();

                // Load and register our audio processor
                await context.audioWorklet.addModule("processor.js");
                // Create it
                const processor = new AudioWorkletNode(context, "1k-processor");

                // Connect it to the OSC, and let it go.
                osc.connect(processor);
                processor.connect(context.destination);
                // osc.connect(context.destination);
                osc.start();
            }
        </script>
    </body>
</html>
